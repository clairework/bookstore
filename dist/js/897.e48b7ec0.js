"use strict";(self["webpackChunkbookstore"]=self["webpackChunkbookstore"]||[]).push([[897],{2897:function(e,t,a){a.r(t),a.d(t,{default:function(){return le}});var o=a(3396),l=a(7139),s=a(9242);const i=(0,o._)("div",{class:"spinner-border text-primary m-5",role:"status"},[(0,o._)("span",{class:"visually-hidden"},"Loading...")],-1),n={class:"container",style:{"min-height":"74vh"}},d={class:"container"},p=(0,o._)("h2",{class:"text-gray700 text-center fw-bold me-4 p-2 pt-5"},"優惠券管理",-1),c={class:"d-flex justify-content-between align-items-center mb-4"},r=(0,o._)("div",{class:"d-flex align-items-center"},null,-1),u={class:"admin-coupon table-responsive rounded-2"},h={class:"table text-nowrap caption-top table-hove text-gray600"},m=(0,o._)("thead",null,[(0,o._)("tr",{class:"bg-primary fs-5 text-white"},[(0,o._)("th",{scope:"col"},"優惠碼"),(0,o._)("th",{scope:"col"},"名稱"),(0,o._)("th",{scope:"col"},"折扣百分比"),(0,o._)("th",{scope:"col"},"到期日"),(0,o._)("th",{scope:"col"},"是否啟用"),(0,o._)("th",{scope:"col"},"編輯"),(0,o._)("th",{scope:"col"},"刪除")])],-1),_={class:"bg-white text-gray600"},b={class:"ps-2"},g={class:"switch"},f=["onUpdate:modelValue","onChange"],w=(0,o._)("span",{class:"slider"},null,-1),v=["onClick"],M=(0,o._)("i",{class:"bi bi-pencil-square cursor-pointer text-primaryDark fs-4 me-6"},null,-1),C=[M],y=["onClick"],x=(0,o._)("i",{class:"bi bi-trash cursor-pointer text-primaryDark fs-4"},null,-1),D=[x];function k(e,t,a,M,x,k){const L=(0,o.up)("LoadingView"),$=(0,o.up)("CouponModal"),N=(0,o.up)("DelModal");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(L,{class:"loading",active:x.isLoading},{default:(0,o.w5)((()=>[i])),_:1},8,["active"]),(0,o._)("div",n,[(0,o._)("div",d,[p,(0,o._)("div",c,[r,(0,o._)("div",{class:"btn btn-outline-primary text-primary fw-bold rounded-2",style:{"font-size":"18px"},onClick:t[0]||(t[0]=e=>k.openModal("isCreateNew"))}," 新增優惠券 ")]),(0,o._)("div",u,[(0,o._)("table",h,[m,(0,o._)("tbody",_,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(x.coupons,(t=>((0,o.wg)(),(0,o.iD)("tr",{key:t.id},[(0,o._)("td",null,(0,l.zw)(t.code),1),(0,o._)("td",null,(0,l.zw)(t.title),1),(0,o._)("td",null,(0,l.zw)(t.percent)+" %",1),(0,o._)("td",null,(0,l.zw)(e.$filters.date(t.due_date)),1),(0,o._)("td",b,[(0,o._)("label",g,[(0,o.wy)((0,o._)("input",{type:"checkbox","onUpdate:modelValue":e=>t.is_enabled=e,onChange:e=>k.updateCoupon(t,!1),"true-value":1,"false-value":0},null,40,f),[[s.e8,t.is_enabled]]),w])]),(0,o._)("td",null,[(0,o._)("div",{class:"d-flex align-items-center",onClick:e=>k.openModal("edit",t)},C,8,v)]),(0,o._)("td",null,[(0,o._)("div",{class:"d-flex align-items-center",onClick:e=>k.openModal("delete",t)},D,8,y)])])))),128))])])])])]),(0,o.Wm)($,{ref:"couponModal",temp:x.temp,isCreateNew:x.isCreateNew,onUpdateCoupons:k.updateCoupon},null,8,["temp","isCreateNew","onUpdateCoupons"]),(0,o.Wm)(N,{ref:"delModal",temp:x.temp,onDelItem:k.delCouponItem},null,8,["temp","onDelItem"])],64)}var L=a(2578),$=a(6294);const N={class:"modal fade",ref:"modal",tabindex:"-1"},U={class:"modal-dialog modal-dialog-centered modal"},V={class:"modal-content background-transparent"},z=(0,o._)("div",{class:"modal-header bg-primaryLight text-center p-3"},[(0,o._)("h4",{class:"modal-title text-dark"},"新增優惠券")],-1),Z={class:"modal-body bg-white p-6"},I={class:"row"},W={class:"mb-3 col"},H=(0,o._)("label",{for:"code",class:"form-label"},"優惠碼",-1),Y={class:"mb-3 col"},j=(0,o._)("label",{for:"title",class:"form-label"},"名稱",-1),q={class:"row"},K={class:"mb-3 col"},S=(0,o._)("label",{for:"percent",class:"form-label"},"折扣百分比",-1),T={class:"mb-3 col"},A=(0,o._)("label",{for:"due_date",class:"form-label"},"到期日",-1),B=(0,o._)("p",{class:"fw-bold fs-4 mb-2"},"是否啟用",-1),E={class:"switch"},F=(0,o._)("span",{class:"slider"},null,-1),G={class:"modal-footer flex-nowrap bg-white"},J=(0,o._)("button",{type:"button",class:"btn btn-outline-primary","data-bs-dismiss":"modal"},"取消",-1);function O(e,t,a,l,i,n){return(0,o.wg)(),(0,o.iD)("div",N,[(0,o._)("div",U,[(0,o._)("div",V,[z,(0,o._)("div",Z,[(0,o._)("div",I,[(0,o._)("div",W,[H,(0,o.wy)((0,o._)("input",{id:"code",type:"text",min:"0",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":t[0]||(t[0]=t=>e.tempModalData.code=t)},null,512),[[s.nr,e.tempModalData.code,void 0,{trim:!0}]])]),(0,o._)("div",Y,[j,(0,o.wy)((0,o._)("input",{id:"title",type:"text",min:"0",class:"form-control",placeholder:"請輸入名稱","onUpdate:modelValue":t[1]||(t[1]=t=>e.tempModalData.title=t)},null,512),[[s.nr,e.tempModalData.title,void 0,{trim:!0}]])])]),(0,o._)("div",q,[(0,o._)("div",K,[S,(0,o.wy)((0,o._)("input",{id:"percent",type:"text",min:"0",class:"form-control",placeholder:"請輸入折扣百分比","onUpdate:modelValue":t[2]||(t[2]=t=>e.tempModalData.percent=t)},null,512),[[s.nr,e.tempModalData.percent,void 0,{number:!0}]])]),(0,o._)("div",T,[A,(0,o.wy)((0,o._)("input",{id:"due_date",type:"date",min:"0",class:"form-control",placeholder:"到期日","onUpdate:modelValue":t[3]||(t[3]=e=>i.due_date=e)},null,512),[[s.nr,i.due_date]])])]),B,(0,o._)("label",E,[(0,o.wy)((0,o._)("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=t=>e.tempModalData.is_enabled=t),"true-value":1,"false-value":0},null,512),[[s.e8,e.tempModalData.is_enabled]]),F])]),(0,o._)("div",G,[J,(0,o._)("button",{type:"button",class:"btn btn-primary text-white",onClick:t[5]||(t[5]=t=>e.$emit("update-Coupons",e.tempModalData,a.isCreateNew))},"確定")])])])],512)}var P=a(1339),Q={mixins:[P.Z],props:["isCreateNew"],data(){return{due_date:""}},watch:{temp:{handler(){const e=new Date(1e3*this.tempModalData.due_date);this.due_date=e.toLocaleDateString()},deep:!0},due_date(){this.tempModalData.due_date=Math.floor(new Date(this.due_date)/1e3)}}},R=a(89);const X=(0,R.Z)(Q,[["render",O]]);var ee=X,te=a(5384),ae={data(){return{temp:{},coupons:{},isCreateNew:!0,isLoading:!1}},components:{CouponModal:ee,DelModal:te.Z},methods:{...(0,L.nv)($.Z,["pushMsg"]),getCoupons(){this.isLoading=!0,this.$http.get("https://vue3-course-api.hexschool.io/api/claire0127-api/admin/coupons").then((e=>{this.coupons=e.data.coupons,this.isLoading=!1})).catch((()=>{this.isLoading=!1}))},openModal(e,t){"isCreateNew"===e?(this.temp={due_date:(new Date).getTime()/1e3,is_enabled:0},this.isCreateNew=!0,this.$refs.couponModal.openModal()):"edit"===e?(this.temp={...t},this.isCreateNew=!1,this.$refs.couponModal.openModal()):"delete"===e&&(this.temp={...t},this.$refs.delModal.openModal())},updateCoupon(e,t){let a="https://vue3-course-api.hexschool.io/api/claire0127-api/admin/coupon",o="post";!1===t&&(o="put",a=`https://vue3-course-api.hexschool.io/api/claire0127-api/admin/coupon/${e.id}`),this.isLoading=!0,this.$http[o](a,{data:e}).then((e=>{this.isLoading=!1,this.pushMsg(e,"更新","已成功更新優惠券"),this.$refs.couponModal.hideModal(),this.getCoupons()})).catch((()=>{this.isLoading=!1,this.pushMsg(!1,"更新","更新優惠券失敗")}))},delCouponItem(e){this.isLoading=!0,this.$http.delete(`https://vue3-course-api.hexschool.io/api/claire0127-api/admin/coupon/${e.id}`).then((e=>{this.pushMsg(e,"更新","已成功刪除優惠券"),this.isLoading=!1,this.$refs.delModal.hideModal(),this.getCoupons()})).catch((()=>{this.pushMsg(!1,"更新","刪除優惠券失敗"),this.isLoading=!1}))}},mounted(){this.getCoupons()}};const oe=(0,R.Z)(ae,[["render",k]]);var le=oe}}]);
//# sourceMappingURL=897.e48b7ec0.js.map